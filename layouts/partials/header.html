{{- /* theme-toggle is enabled */}}
{{- if (not site.Params.disableThemeToggle) }}
{{- /* theme is light */}}
{{- if (eq site.Params.defaultTheme "light") }}
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>
{{- /* theme is dark */}}
{{- else if (eq site.Params.defaultTheme "dark") }}
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>
{{- else }}
{{- /* theme is auto */}}
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
{{- end }}
{{- /* theme-toggle is disabled and theme is auto */}}
{{- else if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark"))}}
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
{{- end }}

<header class="header">
    <nav class="nav">
        <div class="logo">
            {{- $label_text := (site.Params.label.text | default site.Title) }}
            {{- if site.Title }}
            <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
                {{- if site.Params.label.icon }}
                {{- $img := resources.Get site.Params.label.icon }}
                {{- if $img }}
                {{- $processableFormats := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") -}}
                {{- if hugo.IsExtended -}}
                {{- $processableFormats = $processableFormats | append "webp" -}}
                {{- end -}}
                {{- $prod := (hugo.IsProduction | or (eq site.Params.env "production")) }}
                {{- if and (in $processableFormats $img.MediaType.SubType) (eq $prod true)}}
                {{- if site.Params.label.iconHeight }}
                {{- $img = $img.Resize (printf "x%d" site.Params.label.iconHeight) }}
                {{ else }}
                {{- $img = $img.Resize "x30" }}
                {{- end }}
                {{- end }}
                <img src="{{ $img.Permalink }}" alt="" aria-label="logo"
                    height="{{- site.Params.label.iconHeight | default " 30" -}}">
                {{- else }}
                <img src="{{- site.Params.label.icon | absURL -}}" alt="" aria-label="logo"
                    height="{{- site.Params.label.iconHeight | default " 30" -}}">
                {{- end -}}
                {{- else if hasPrefix site.Params.label.iconSVG "<svg" }} {{ site.Params.label.iconSVG | safeHTML }} {{-
                    end -}} {{- $label_text -}} </a>
                    {{- end }}
                    <div class="logo-switches">
                        {{- if (not site.Params.disableThemeToggle) }}
                        <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </button>
                        {{- end }}

                        {{- $lang := .Lang}}
                        {{- $separator := or $label_text (not site.Params.disableThemeToggle)}}
                        {{- with site.Home.AllTranslations }}
                        <ul class="lang-switch">
                            {{- if $separator }}<li>|</li>{{ end }}
                            {{- range . -}}
                            {{- if ne $lang .Lang }}
                            <li>
                                <a href="{{- .Permalink -}}"
                                    title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                                    aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                                    {{- if (and site.Params.displayFullLangName (.Language.LanguageName)) }}
                                    {{- .Language.LanguageName | emojify -}}
                                    {{- else }}
                                    {{- .Lang | title -}}
                                    {{- end -}}
                                </a>
                            </li>
                            {{- end -}}
                            {{- end}}
                        </ul>
                        {{- end }}
                    </div>
        </div>
        {{- $currentPage := . }}
        <button id="menu-trigger" aria-haspopup="menu" aria-label="Menu Button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <ul class="menu hidden">
            {{- range site.Menus.main }}
            {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL) ) | absLangURL }}
            {{- $page_url:= $currentPage.Permalink | absLangURL }}
            {{- $is_search := eq (site.GetPage .KeyName).Layout `search` }}
            <li>
                <a href="{{ .URL | absLangURL }}" title="{{ .Title | default .Name }} {{- cond $is_search (" (Alt + /)"
                    | safeHTMLAttr) ("" | safeHTMLAttr ) }}" {{- cond $is_search (" accesskey=/" | safeHTMLAttr) ("" |
                    safeHTMLAttr ) }}>
                    <span {{- if eq $menu_item_url $page_url }} class="active" {{- end }}>
                        {{- .Pre }}
                        {{- .Name -}}
                        {{ .Post -}}
                    </span>
                    {{- if (findRE "://" .URL) }}&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                    {{- end }}
                </a>
            </li>
            {{- end }}
        </ul>
    </nav>
</header>

<div class="grass">
    <div class="canvas-container">
        <canvas id="fieldCanvas" style="width: 100%; height: 100%"> </canvas>
    </div>
</div>
<script>
    const daisyP1 = new Path2D(
        "m -1.829031,-3.4426 c 2.503845,1.109686 2.9913,2.290752 1.21864001,2.95266399 C -3.114236,-1.599621 -3.601691,-2.780687 -1.829031,-3.4426 Z"
    );
    const daisyP2 = new Path2D(
        "m 2.300026,-3.484848 c -2.503845,1.109686 -2.99129999,2.290752 -1.21864,2.95266399 C 3.585231,-1.641869 4.072686,-2.822935 2.300026,-3.484848 Z"
    );
    const daisyP3 = new Path2D(
        "M 0.816802,-0.26458301 C 3.51306,-0.14178401 5.726339,-0.98493001 6.35,-2.372448 3.653744,-2.495247 1.440465,-1.652101 0.816802,-0.26458301 Z"
    );
    const daisyP4 = new Path2D(
        "M 0,-0.01181901 C -2.696258,0.11097999 -4.909537,-0.73216601 -5.533198,-2.119684 -2.836942,-2.242483 -0.62366299,-1.399337 0,-0.01181901 Z"
    );

    const daisyP6 = new Path2D(
        "m 1.875136,-0.00301701 c 2.645834,-1.32291699 5.291668,-1.32291699 6.614583,0 -2.645832,1.32291701 -5.291665,1.32291701 -6.614583,0 z"
    );
    const daisyP7 = new Path2D(
        "m -1.829031,-0.00301701 c -2.645834,-1.32291699 -5.291668,-1.32291699 -6.614583,0 2.645832,1.32291701 5.291665,1.32291701 6.614583,0 z"
    );
    const daisyP8 = new Path2D(
        "M 1.369021,0.52614899 C 4.323135,0.37200999 6.748081,1.430343 7.431386,3.171983 4.477274,3.326123 2.052328,2.26779 1.369021,0.52614899 Z"
    );
    const daisyP9 = new Path2D(
        "M -1.299864,0.51131299 C -4.253978,0.35717399 -6.678925,1.415507 -7.36223,3.157147 c 2.954112,0.15414 5.379058,-0.904193 6.062366,-2.64583401 z"
    );
    const daisyP10 = new Path2D(
        "M 2.139719,3.70115 C -0.364126,2.591464 -0.85158099,1.410398 0.921079,0.74848599 3.424924,1.858171 3.912379,3.039237 2.139719,3.70115 Z"
    );
    const daisyP11 = new Path2D(
        "M -1.989338,3.743397 C 0.514507,2.633711 1.001962,1.452645 -0.77069799,0.79073299 -3.274543,1.900418 -3.761998,3.081484 -1.989338,3.743397 Z"
    );

    const dandelionP1 = new Path2D(
        "m -45,4 c -1.414934,-2.876093 -2.100056,-5.4210621 2,-5 -1.968165,-3.7840138 -2.302503,-6.31186 3,-6 -1.389917,-4.817172 0.130775,-6.623457 4,-6 -0.391835,-4.30329 2.057204,-5.296502 5,-5 -0.48476,-4.176454 1.533281,-5.19195 5,-4 -0.627166,-3.436124 1.754186,-3.620405 5,-3 0.627798,-4.887428 3.101844,-5.075781 7,-3 1.841788,-6.7606 5.8301249,-3.338211 9,-2 2.9321221,-2.952829 5.99383145,-4.938703 10,0 3.6088081,-3.244201 6.639346,-2.773706 9,2 4.347721,-2.3452 6.663777,-1.316507 7,3 3.37192,-2.047339 5.418373,-1.726031 5,3 3.003016,-0.850591 5.463063,-0.813838 5,4 2.980987,-0.03502 5.463246,0.575684 5,5 3.971426,0.668308 5.34908,2.645936 4,6 4.093131,0.681366 5.496115,2.50957 3,6 2.622922,-0.045979 4.454127,0.6011677 2,5 3.431192,1.413953 1.573877,3.70111 1,5 1.992604,2.761079 0.843658,4.174814 -1,5 0.487165,4.733817 -2.378917,4.958339 -5,5 -1.025629,2.821706 -3.73235,4.092308 -9,3 -1.667632,3.357083 -5.365211,3.982146 -11,2 -3.140661,2.088364 -6.423381,2.857878 -10,1 -2.9263312,2.106375 -6.0734141,3.17669 -10,0 -3.737654,3.093317 -6.9553176,2.208368 -10,0 -3.446424,1.763367 -6.768036,1.212707 -10,-1 -3.836817,1.529717 -7.585679,1.924079 -11,-2 -5.495895,1.155748 -7.945019,-0.320053 -9,-3 -3.686076,0.365336 -5.292649,-1.343647 -5,-5 -2.41758,-1.013449 -2.596188,-2.728607 -1,-5 -1.246693,-1.998542 -1.805377,-3.852571 1,-5 z"
    );
    const dandelionP2 = new Path2D(
        "m -40.177191,3.500819 c -1.263291,-2.396632 -1.874986,-4.51734 1.785652,-4.166471 -1.75723,-3.1531977 -2.055735,-5.2596379 2.67848,-4.9997665 -1.240955,-4.0141221 0.116759,-5.5192895 3.571306,-4.9997665 -0.349841,-3.585907 1.836726,-4.413545 4.464132,-4.166471 -0.432806,-3.480216 1.368954,-4.326423 4.464132,-3.333178 -0.559949,-2.863302 1.566184,-3.016863 4.464133,-2.499883 0.560515,-4.072665 2.769409,-4.229619 6.249785,-2.499883 1.644398,-5.63357 5.2052904,-2.781712 8.0354391,-1.666588 2.6178759,-2.460576 5.3514509,-4.115393 8.9282649,0 3.222039,-2.703375 5.927784,-2.311314 8.035438,1.666588 3.881761,-1.954241 5.949597,-1.097037 6.249785,2.499883 3.01054,-1.706036 4.837667,-1.438291 4.464133,2.499883 2.681172,-0.708792 4.877567,-0.678166 4.464132,3.333178 2.661505,-0.02918 4.877731,0.479714 4.464132,4.166471 3.545795,0.556898 4.775801,2.204844 3.571307,4.9997665 3.654456,0.5677788 4.907077,2.0912105 2.678479,4.9997665 2.341815,-0.03832 3.976763,0.50095 1.785653,4.166471 3.063459,1.178239 1.405199,3.084114 0.892826,4.166472 1.77905,2.300791 0.75324,3.478849 -0.892826,4.166472 0.434954,3.944662 -2.12396,4.131755 -4.464132,4.166471 -0.915709,2.351312 -3.332341,3.410098 -8.035439,2.499883 -1.488906,2.797438 -4.790202,3.3183 -9.821091,1.666589 C 15.052465,21.906928 12.121565,22.548159 8.928265,21 6.315559,22.755231 3.50576,23.647118 0,21 c -3.3370765,2.577644 -6.2098913,1.840221 -8.9282646,0 -3.0770584,1.469404 -6.0426814,1.010543 -8.9282644,-0.833294 -3.425612,1.274704 -6.772696,1.603324 -9.821092,-1.666589 -4.90688,0.963079 -7.093524,-0.266698 -8.035438,-2.499883 -3.291027,0.304433 -4.725417,-1.119653 -4.464132,-4.166471 -2.15848,-0.844502 -2.317946,-2.273733 -0.892827,-4.166472 -1.113081,-1.665374 -1.611889,-3.210326 0.892827,-4.166472 z"
    );
    const dandelionP3 = new Path2D(
        "m -35.238343,3.059217 c -1.107999,-1.909286 -1.644501,-3.598755 1.566147,-3.319234 -1.541219,-2.512006 -1.80303,-4.190109 2.349224,-3.983082 -1.088409,-3.197864 0.102406,-4.396961 3.132297,-3.983081 -0.306836,-2.856724 1.610943,-3.516065 3.915371,-3.319233 -0.379602,-2.772526 1.200673,-3.44666 3.915371,-2.655388 -0.491116,-2.281059 1.373659,-2.403394 3.915372,-1.99154 0.491613,-3.244503 2.428976,-3.369541 5.481521,-1.991541 1.442257,-4.488003 4.565421,-2.21606 7.047668,-1.327693 2.29607,-1.960226 4.693616,-3.278542 7.830744,0 2.825965,-2.153653 5.199101,-1.841316 7.047668,1.327693 3.404589,-1.556853 5.218233,-0.873958 5.481521,1.991541 2.640464,-1.35912 4.242988,-1.14582 3.915372,1.99154 2.351584,-0.564661 4.277983,-0.540263 3.915371,2.655388 2.334335,-0.02324 4.278128,0.382165 3.915371,3.319233 3.109923,0.443655 4.188728,1.756497 3.132299,3.983081 3.205226,0.452323 4.303865,1.665971 2.349221,3.983082 2.053944,-0.03053 3.487913,0.399084 1.56615,3.319234 2.686877,0.938648 1.232462,2.45697 0.783073,3.319234 1.560357,1.832933 0.660647,2.771437 -0.783073,3.319235 0.381486,3.142528 -1.862869,3.291576 -3.915371,3.319233 -0.803144,1.873181 -2.922708,2.716666 -7.04767,1.991541 -1.30588,2.228588 -4.201358,2.643534 -8.613817,1.327693 C 13.202116,17.722507 10.631502,18.233346 7.830744,17 5.539209,18.39831 3.074808,19.108835 0,17 c -2.926861,2.053489 -5.44653,1.466018 -7.830743,0 -2.698805,1.170605 -5.299875,0.805052 -7.830743,-0.663847 -3.004513,1.015497 -5.940151,1.277294 -8.613818,-1.327693 -4.303693,0.767239 -6.221541,-0.212467 -7.047668,-1.991541 -2.886472,0.242527 -4.144538,-0.891976 -3.915371,-3.319233 -1.893146,-0.672777 -2.033009,-1.811378 -0.783075,-3.319235 -0.976254,-1.326726 -1.413745,-2.557517 0.783075,-3.319234 z"
    );
    const dandelionP4 = new Path2D(
        "m -30.539106,1.7231931 c -0.949113,-1.414632 -1.408681,-2.666396 1.341562,-2.459293 -1.320209,-1.8612 -1.544476,-3.104543 2.012348,-2.951153 -0.932332,-2.369367 0.08772,-3.257804 2.683128,-2.951151 -0.262836,-2.11661 1.379935,-2.60513 3.35391,-2.459293 -0.325167,-2.0542251 1.028498,-2.5537051 3.353911,-1.9674351 -0.420691,-1.690086 1.176677,-1.780727 3.353911,-1.475575 0.421116,-2.403923 2.080663,-2.496567 4.695475,-1.475576 1.235439,-3.32526 3.910744,-1.641928 6.037039,-0.983717 1.966816,-1.452374 4.020556,-2.429143 6.707822,0 2.420724,-1.595689 4.453555,-1.364271 6.037039,0.983717 2.916374,-1.153507 4.469943,-0.647535 4.695475,1.475576 2.261824,-1.007002 3.634548,-0.848963 3.353912,1.475575 2.014369,-0.418369 3.664524,-0.400292 3.35391,1.9674351 1.999593,-0.01722 3.664648,0.283155 3.35391,2.459293 2.663963,0.328713 3.588068,1.301427 2.68313,2.951151 2.7456,0.335136 3.686695,1.234355 2.012345,2.951153 1.75941,-0.02262 2.987749,0.29569 1.341565,2.459293 2.301582,0.695465 1.055728,1.820423 0.670781,2.459293 1.336604,1.35806 0.565911,2.053418 -0.670781,2.459294 0.326782,2.328367 -1.595735,2.4388 -3.35391,2.459292 -0.687974,1.3878809 -2.503594,2.0128369 -6.03704,1.4755759 -1.118618,1.65121 -3.598887,1.958652 -7.378603,0.983717 -2.1067,1.02718 -4.30869,1.405672 -6.707822,0.491859 -1.962931,1.036038 -4.073939,1.562482 -6.707822,0 -2.507152,1.521475 -4.665502,1.086205 -6.707821,0 -2.311799,0.867327 -4.539878,0.59648 -6.707822,-0.491859 -2.573668,0.752404 -5.088338,0.946375 -7.378604,-0.983717 -3.686547,0.568464 -5.329377,-0.157421 -6.037038,-1.4755759 -2.472554,0.179694 -3.550215,-0.660884 -3.35391,-2.459292 -1.621671,-0.498475 -1.741477,-1.34209 -0.670783,-2.459294 -0.83626,-0.983 -1.211015,-1.89492 0.670783,-2.459293 z"
    );
    const dandelionP5 = new Path2D(
        "m -26.149395,0.787184 c -0.796591,-0.912499 -1.182307,-1.719941 1.125974,-1.586351 -1.108052,-1.200554 -1.296279,-2.002564 1.688965,-1.903621 -0.782507,-1.528345 0.07362,-2.101425 2.251952,-1.90362 -0.220599,-1.365306 1.15818,-1.680422 2.814938,-1.586351 -0.272912,-1.325064 0.86322,-1.64725 2.81494,-1.269081 -0.353086,-1.090179 0.987586,-1.148646 2.81494,-0.95181 0.353443,-1.550634 1.746302,-1.610394 3.940915,-0.95181 1.036905,-2.144937 3.282291,-1.059115 5.066891,-0.63454 1.65075,-0.936844 3.374456,-1.566903 5.62988,0 2.031715,-1.029289 3.737872,-0.880014 5.066891,0.63454 2.447715,-0.744062 3.751626,-0.417688 3.940915,0.95181 1.898351,-0.64956 3.050479,-0.547618 2.814941,0.95181 1.690661,-0.269866 3.075638,-0.258206 2.814939,1.269081 1.67826,-0.01111 3.075742,0.182647 2.814939,1.586351 2.235866,0.212034 3.011468,0.839476 2.251953,1.90362 2.304384,0.216177 3.094245,0.796212 1.688962,1.903621 1.476674,-0.01459 2.50762,0.190733 1.125977,1.586351 1.931719,0.448605 0.886073,1.174252 0.562987,1.586351 1.121812,0.876007 0.474969,1.324543 -0.562987,1.586351 0.274268,1.501897 -1.339302,1.573132 -2.814939,1.58635 -0.577417,0.895243 -2.101268,1.298367 -5.066892,0.95181 -0.938857,1.065102 -3.020548,1.263416 -6.192867,0.63454 -1.768154,0.662576 -3.616286,0.90672 -5.629879,0.317271 -1.64749,0.668289 -3.41926,1.007868 -5.62988,0 -2.104254,0.981417 -3.915759,0.700649 -5.629879,0 -1.940294,0.559463 -3.810322,0.384755 -5.629879,-0.317271 -2.160081,0.485334 -4.270646,0.610453 -6.192868,-0.63454 -3.094121,0.366684 -4.472949,-0.101543 -5.06689,-0.95181 -2.075216,0.11591 -2.979698,-0.426299 -2.814939,-1.58635 -1.361069,-0.321538 -1.461622,-0.865706 -0.562988,-1.586351 -0.701874,-0.634078 -1.016406,-1.222306 0.562988,-1.586351 z"
    );
    const dandelionP6 = new Path2D(
        "m -15.891482,0.241398 c -0.646405,-0.58205567 -1.212503,-1.2499732 0.675658,-0.770794 -0.664904,-0.8275092 -0.777853,-1.5708771 1.01349,-0.924952 -0.698689,-1.7864403 -0.09716,-1.6649429 1.351319,-0.924953 -0.568292,-1.5507921 -0.02094,-2.2739126 1.689147,-0.770794 -0.392026,-1.6095572 0.207277,-2.1149365 1.6891487,-0.616635 0.2394423,-2.30843 0.835936,-1.5170842 1.689148,-0.462476 0.4500332,-2.0080551 1.2681438,-1.9437838 2.364807,-0.462477 C -4.0279367,-7.3940986 -3.2485925,-5.6395531 -2.3782968,-5 -1.3729093,-6.6415639 -0.3272502,-7.8534799 1,-5 c 1.4563967,-1.8246824 2.505469,-1.893219 3.0404671,0.308317 1.5170327,-1.567606 2.2858319,-1.0682018 2.3648076,0.462477 1.5214215,-1.5389329 2.0655599,-1.0183153 1.6891488,0.462476 1.0734937,-0.7357317 1.9504495,-1.2003167 1.6891481,0.616635 1.1213564,-0.4149382 2.2036044,-1.1939285 1.6891484,0.770794 1.555805,-0.3847352 2.316231,-0.7518437 1.351319,0.924953 1.656658,-0.3782734 2.283938,-0.3669898 1.013488,0.924952 1.003511,-0.10885468 1.967665,-0.30852421 0.675661,0.770794 1.537563,0.18886587 0.670288,0.55989849 0.337829,0.770795 1.127448,0.7587885 0.416759,0.7401972 -0.337829,0.770794 C 14.96135,3.3634958 13.770169,2.7293121 12.824039,2.55378 12.511678,3.5689244 11.649054,4.6451735 9.7835716,3.016256 9.11506,4.1359239 7.6431485,5.5080899 6.0674457,3.324574 5.0198232,4.6102823 3.9246738,5.7262144 2.6891488,3.478733 c -0.9399273,1.2008651 -1.93938143,2.5128847 -3.3782968,0 -1.5053628,2.2726368 -2.521072,1.6084973 -3.3782969,0 -1.3279385,1.4470355 -2.5737143,2.2500839 -3.3782964,-0.154159 -1.6875783,1.5241389 -3.1618467,2.2689138 -3.7161267,-0.308318 -2.764798,2.5042095 -2.946382,0.4618003 -3.040466,-0.462476 -1.996788,1.3088561 -2.126871,0.3576262 -1.689148,-0.770793 -1.383843,0.0058 -1.476441,-0.2493903 -0.33783,-0.770794 -0.67612,-0.43556744 -1.236802,-0.90735326 0.33783,-0.770795 z"
    );
    // Constans ///////////////////////////////////////////////////
    const WIND_MAX = 4.0;
    const DAMPING_THRESHOLD = 0.6;
    const MAX_BEND_ANGLE_DEG = 90;
    const MAX_BEND_ANGLE_RADS = (Math.PI / 180) * MAX_BEND_ANGLE_DEG;
    const MAX_BEND_ANGLE_DAISIES_RADS = (Math.PI / 180) * 45;
    const MAX_BEND_ANGLE_DANDELION_RADS = (Math.PI / 180) * 60;

    // Init and Cleanup ///////////////////////////////////////////
    function init(canvas) {
        // Setup Canvas variables
        windowHeight = window.innerHeight;
        fieldCanvas = canvas;
        fieldCanvasCtx = fieldCanvas?.getContext("2d");
        canvasWidth = fieldCanvas?.clientWidth ?? 100;
        canvasHeight = fieldCanvas?.clientHeight ?? 100;
        fieldCanvas.width = canvasWidth;
        fieldCanvas.height = canvasHeight;

        // Setup Grass
        setupGrass();

        setTimeout(() => {
            currentWinds.push({
                wind: 0.6,
                posX: 0,
                speed: 1000 / 1000,
                speedUp: 2 / 1000,
                powerUp: 0.9 / 1000,
            });
            startAnimationIfNotAlreadyRunning();
        }, 1000);
        setTimeout(() => {
            currentWinds.push({
                wind: -0.8,
                posX: canvasWidth + 10,
                speed: -500 / 1000,
                speedUp: -2 / 1000,
                powerUp: -0.5 / 1000,
            });
            startAnimationIfNotAlreadyRunning();
        }, 3000);

        // Setup lsiteners and events
        window.addEventListener("resize", onWindowResize);
        window.addEventListener("mousemove", onMouseMove);
    }

    function destroy() {
        window.removeEventListener("mousemove", onMouseMove);
        window.removeEventListener("resize", onWindowResize);
        stopAnimation();
    }

    // State Variables ///////////////////////////////////////////
    let fieldCanvas = null;
    let fieldCanvasCtx = null;
    let canvasWidth = 0;
    let canvasHeight = 0;
    let windowHeight = 0;

    // var windIntervalId = 0;
    let requestAnimationFrameId = 0;
    let lastAnimationTimeStamp = 0;

    /**
     * pixelPerGrass: Abstand zweier Grassblätter
     * grassHeight: Höhe in Pixel
     * grassWidth: Breite in Pixel
     * angleVarianceDeg: Maximale zufällige Rotation des Blattes in beide Richtungen in Degree
     * sizeVariance: scale = 1 +- [0,sizeVariance)
     */
    const layers = [
        {
            grassBlades: null,
            offset: 2,
            color: "#323232",
            pixelPerGrass: 15,
            grassHeight: 90,
            grassWidth: 10,
            angleVarianceDeg: 10,
            sizeVariance: 0.2,
        },
        {
            grassBlades: null,
            offset: 20,
            color: "#323232",
            pixelPerGrass: 90,
            grassHeight: 70,
            grassWidth: 3,
            angleVarianceDeg: 20,
            sizeVariance: 0.2,
            type: "daisy",
        },
        {
            grassBlades: null,
            offset: 10,
            color: "#323232",
            pixelPerGrass: 300,
            grassHeight: 90,
            grassWidth: 4,
            angleVarianceDeg: 20,
            sizeVariance: 0.2,
            type: "dendelion",
        },
        {
            grassBlades: null,
            offset: 0,
            color: "#323232",
            pixelPerGrass: 3,
            grassHeight: 100,
            grassWidth: 7,
            angleVarianceDeg: 6,
            sizeVariance: 0.1,
        },
    ];

    /**
     * Array({
     *  wind: Number,
     *  speed: Number, Pixel/Sec
     *  posX: Number, Pixel
     *  speedUp: Number, dSpeed/Sec
     *  powerUp: Number, dWind/Sec
     * })
     */
    let currentWinds = [];

    // Event Listners //////////////////////////////////////

    function onMouseMove(event) {
        //   const leftButtonPressed = (event.buttons & 1) > 0;
        const inRange = event.clientY > windowHeight - canvasHeight;
        if (inRange) {
            const x = event.clientX;
            // const y = event.clientY;
            const dx = event.movementX;
            for (const gl of layers) {
                const grassBlades = gl.grassBlades;
                const delta = dx < 0 ? 2 : -2;
                const { minIndex, maxIndex } = grassBlades.getIndexRangeForPixel(
                    x - dx + delta,
                    x - delta
                );
                const factor = 1 / 15;
                const targetWind =
                    dx >= 0
                        ? Math.min(dx * factor, WIND_MAX)
                        : Math.max(dx * factor, -WIND_MAX);
                for (let i = minIndex; i < maxIndex; i++) {
                    grassBlades.targetWind[i] = Math.max(
                        -5,
                        Math.min(
                            5,
                            // grassBlades.targetWind[i] +
                            (1 + (Math.random() - 0.5) * 0.2) * targetWind
                        )
                    );
                }
            }

            startAnimationIfNotAlreadyRunning();
        }
    }

    function onWindowResize() {
        canvasWidth = fieldCanvas?.clientWidth ?? 100;
        canvasHeight = fieldCanvas?.clientHeight ?? 100;
        windowHeight = window.innerHeight;
        fieldCanvas.width = canvasWidth;
        fieldCanvas.height = canvasHeight;
        fieldCanvasCtx = fieldCanvas?.getContext("2d");

        for (const layer of layers) {
            layer.grassBlades = resizeGrassBlades(
                layer.grassBlades,
                canvasWidth,
                layer
            );
        }
        startAnimationIfNotAlreadyRunning();
    }

    // Setup Functions ///////////////////////////////////////////
    function setupGrass() {
        for (const layer of layers) {
            layer.grassBlades = resizeGrassBlades(null, canvasWidth, layer);
        }
    }

    function resizeGrassBlades(grassBlades = null, canvasWidth, layer) {
        const newSize = Math.ceil(canvasWidth / layer.pixelPerGrass);
        if (grassBlades == null) {
            grassBlades = {
                length: 0,
                spacing: layer.pixelPerGrass,
                offset: layer.offset,
                getIndexRangeForPixel: () => {
                    return { minIndex: 0, maxIndex: 0 };
                },
                // Arrays
                posX: new Float32Array(0),
                rotate: new Float32Array(0),
                scale: new Float32Array(0),
                targetWind: new Float32Array(0),
                currentWind: new Float32Array(0),
            };
        }
        const sizeDiff = newSize - grassBlades.length;
        if (sizeDiff > 0) {
            const posX = new Float32Array(newSize);
            const rotate = new Float32Array(newSize);
            const scale = new Float32Array(newSize);
            const targetWind = new Float32Array(newSize);
            const currentWind = new Float32Array(newSize);
            posX.set(grassBlades.posX, 0);
            rotate.set(grassBlades.rotate, 0);
            scale.set(grassBlades.scale, 0);
            targetWind.set(grassBlades.targetWind, 0);
            currentWind.set(grassBlades.currentWind, 0);
            const degToRad = Math.PI / 180;
            for (let i = grassBlades.length; i < newSize; i++) {
                const posXV = Math.floor(i * grassBlades.spacing + grassBlades.offset);
                const rotateV =
                    (Math.random() - 0.5) * 2 * layer.angleVarianceDeg * degToRad;
                const scaleV = 1 + (Math.random() - 0.5) * 2 * layer.sizeVariance;
                posX[i] = posXV;
                rotate[i] = rotateV;
                scale[i] = scaleV;
                targetWind[i] = 0;
                currentWind[i] = 0;
            }
            grassBlades.posX = posX;
            grassBlades.rotate = rotate;
            grassBlades.scale = scale;
            grassBlades.targetWind = targetWind;
            grassBlades.currentWind = currentWind;
            grassBlades.length = newSize;
            // setIndexRangeFunctionForGrassBlades(grassBlades);
            switch (layer.type) {
                case "dendelion":
                case "daisy":
                    setIndexRangeFunctionForFlowers(grassBlades);
                    break;
                default:
                    setIndexRangeFunctionForGrassBlades(grassBlades);
                    break;
            }
        } else if (sizeDiff < 0) {
            grassBlades.posX = grassBlades.posX.slice(0, newSize);
            grassBlades.rotate = grassBlades.rotate.slice(0, newSize);
            grassBlades.scale = grassBlades.scale.slice(0, newSize);
            grassBlades.targetWind = grassBlades.targetWind.slice(0, newSize);
            grassBlades.currentWind = grassBlades.currentWind.slice(0, newSize);
            grassBlades.length = newSize;
            // setIndexRangeFunctionForGrassBlades(grassBlades);
            switch (layer.type) {
                case "dendelion":
                case "daisy":
                    setIndexRangeFunctionForFlowers(grassBlades);
                    break;
                default:
                    setIndexRangeFunctionForGrassBlades(grassBlades);
                    break;
            }
        }

        return grassBlades;
    }
    function setIndexRangeFunctionForGrassBlades(grassBlades) {
        grassBlades.getIndexRangeForPixel = (startPixel, endPixel) => {
            if (startPixel > endPixel) {
                const help = startPixel;
                startPixel = endPixel;
                endPixel = help;
            }

            const minIndex = Math.max(
                0,
                Math.min(
                    grassBlades.length - 1,
                    Math.floor((startPixel + grassBlades.offset) / grassBlades.spacing)
                )
            );
            const maxIndex = Math.max(
                0,
                Math.min(
                    grassBlades.length,
                    Math.ceil((endPixel + grassBlades.offset) / grassBlades.spacing) - 1
                )
            );
            return { minIndex, maxIndex };
        };
    }

    function setIndexRangeFunctionForFlowers(grassBlades) {
        grassBlades.getIndexRangeForPixel = (startPixel, endPixel) => {
            if (startPixel > endPixel) {
                const help = startPixel;
                startPixel = endPixel;
                endPixel = help;
            }

            let minIndex = grassBlades.length;
            let maxIndex = 0;
            for (let i = 0; i < grassBlades.length; i++) {
                if (
                    grassBlades.posX[i] >= startPixel &&
                    grassBlades.posX[i] <= endPixel
                ) {
                    minIndex = Math.min(minIndex, i);
                    maxIndex = Math.max(maxIndex, i + 1);
                }
            }

            return { minIndex, maxIndex };
        };
    }

    // Animation ////////////////////////////////////////////////

    function startAnimation() {
        if (requestAnimationFrameId) {
            window.cancelAnimationFrame(requestAnimationFrameId);
            requestAnimationFrameId = 0;
        }
        lastAnimationTimeStamp = 0;
        requestAnimationFrameId = requestAnimationFrame(onAnimationFrame);
    }
    function startAnimationIfNotAlreadyRunning() {
        if (!requestAnimationFrameId) {
            lastAnimationTimeStamp = 0;
            requestAnimationFrameId = requestAnimationFrame(onAnimationFrame);
        }
    }

    function stopAnimation() {
        if (requestAnimationFrameId) {
            window.cancelAnimationFrame(requestAnimationFrameId);
            requestAnimationFrameId = 0;
            lastAnimationTimeStamp = 0;
        }
    }

    function onAnimationFrame(timestamp) {
        if (!lastAnimationTimeStamp) {
            lastAnimationTimeStamp = timestamp;
            requestAnimationFrameId = requestAnimationFrame(onAnimationFrame);
            return;
        }
        const delta = timestamp - lastAnimationTimeStamp;
        let noChange = applyWinds(delta);
        clearCanvas();
        for (const gl of layers) {
            const noGlChange = updateWinds(gl.grassBlades, delta);
            noChange = noChange && noGlChange;
            if (gl.type === "daisy") {
                // drawDaisies(fieldCanvasCtx, gl);
            } else if (gl.type === "dendelion") {
                // drawDandelions(fieldCanvasCtx, gl);
            } else {
                drawGlassBlades(fieldCanvasCtx, gl);
            }
        }
        lastAnimationTimeStamp = timestamp;
        if (noChange) {
            // Stop Animation when no change detected.
            requestAnimationFrameId = 0;
        } else {
            requestAnimationFrameId = requestAnimationFrame(onAnimationFrame);
        }
    }

    function applyWinds(deltaTime) {
        currentWinds = currentWinds.filter((x) => x.wind !== 0);
        for (const wind of currentWinds) {
            const oldPos = wind.posX;
            const newPos = wind.posX + deltaTime * wind.speed;

            for (const layer of layers) {
                const gbs = layer.grassBlades;
                const { minIndex, maxIndex } = gbs.getIndexRangeForPixel(oldPos, newPos);
                for (let i = minIndex; i < maxIndex; i++) {
                    gbs.targetWind[i] += wind.wind;
                }
            }
            wind.posX = newPos;
            wind.speed += wind.speedUp * deltaTime;
            wind.wind += wind.powerUp * deltaTime;
            if (
                (wind.speed >= 0 && wind.posX >= canvasWidth) ||
                (wind.speed <= 0 && wind.posX < 0)
            ) {
                wind.wind = 0;
            }
        }
        return currentWinds.length <= 0;
    }

    function updateWinds(grassBlades, timeDelta) {
        let noChange = true;
        const gbs = grassBlades ?? [];
        for (let i = 0; i < gbs.length; i++) {
            // Gradually reduce traget wind to 0
            let targetWind = gbs.targetWind[i];
            if (targetWind >= 0) {
                targetWind = Math.max(0, targetWind - (timeDelta / 1000) * 1);
                gbs.targetWind[i] = targetWind;
            } else {
                targetWind = Math.min(0, targetWind + (timeDelta / 1000) * 1);
                gbs.targetWind[i] = targetWind;
            }

            // close distance between current wind and target wind. The father appart they are the faster close the distance.
            const windDiff = targetWind - gbs.currentWind[i];
            const windDelta = windDiff * (timeDelta / 700);
            gbs.currentWind[i] += windDelta;

            // if current wind is in small tollerance around 0 keep it slightly positive or negative.
            const currentWind = gbs.currentWind[i];
            let currentWindAroundZero = false;
            if (currentWind > -0.001 && currentWind < 0) {
                gbs.currentWind[i] = -0.001;
                currentWindAroundZero = true;
            } else if (currentWind < 0.001 && currentWind >= 0) {
                gbs.currentWind[i] = 0.001;
                currentWindAroundZero = true;
            }

            // if no change is detected give system chance to stop animation.
            noChange = noChange && targetWind == 0 && currentWindAroundZero;
        }
        return noChange;
    }
    // Draw On Canvas ///////////////////////////////////////////
    function clearCanvas() {
        fieldCanvasCtx.clearRect(0, 0, canvasWidth, canvasHeight);
    }
    function drawBlade(ctx, state = 0, gbWidth, gbHeight) {
        const h = gbHeight;
        const w = 2 * gbWidth;
        const angle = state * -MAX_BEND_ANGLE_RADS;
        const sin = Math.sin(angle);
        const cos = Math.cos(angle);
        const toX = cos * w - sin * h;
        const toY = sin * w + cos * h;
        const tangX = cos * -w;
        const tangY = sin * -w;
        //   const tang2X = cos * -(w / 2) - (sin * w) / 2;
        //   const tang2Y = sin * -(w / 2) + (cos * w) / 2;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(0, -w, toX + tangX, -(toY + tangY), toX, -toY);
        ctx.bezierCurveTo(toX + tangX, -(toY + tangY), w / 2, -w, w / 2, 0);
        ctx.fill();
    }

    function drawGlassBlades(ctx, gl) {
        const gbs = gl.grassBlades;
        ctx.strokeStyle = gl.color; //"green";
        ctx.fillStyle = gl.color; //"green";
        const midOffset = gl.grassWidth / 2;
        for (let i = 0; i < gbs.length; i++) {
            const scaleX = gbs.currentWind[i] < 0 ? -1 : 1;
            const state = currentWindToState(gbs.currentWind[i]);
            ctx.save();
            ctx.translate(gbs.posX[i], 150);
            ctx.translate(-midOffset, 0);
            ctx.rotate(gbs.rotate[i]);
            ctx.scale(scaleX, gbs.scale[i]);
            drawBlade(ctx, state, gl.grassWidth, gl.grassHeight);
            ctx.restore();
        }
    }

    function currentWindToState(currentWind) {
        //takes currentWind in (-inf, inf) and returns state in [0, 1)
        let state = Math.abs(currentWind);
        if (state > DAMPING_THRESHOLD) {
            state = 1 - (1 - DAMPING_THRESHOLD) / (1 * (state - DAMPING_THRESHOLD) + 1);
        }
        return state;
    }

    // Daisy ////////////////////////////////////////////////

    function drawDaisies(ctx, gl) {
        const height = gl.grassHeight;
        const widht = gl.grassWidth;
        const das = gl.grassBlades;
        for (let i = 0; i < das.length; i++) {
            const scaleX = das.currentWind[i] < 0 ? -1 : 1;
            const state = currentWindToState(das.currentWind[i]);
            ctx.save();
            ctx.translate(das.posX[i], 150);
            ctx.rotate(das.rotate[i]);
            ctx.scale(scaleX * das.scale[i], das.scale[i]);
            drawDaisy(ctx, state, height, widht, gl.color);
            ctx.restore();
        }
    }
    function drawDaisy(ctx, state, height, width, color) {
        const h = height;
        const angle = state * MAX_BEND_ANGLE_DAISIES_RADS;
        const curve = (angle * 20) / 1.5708;
        ctx.rotate(angle);
        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(-curve, -h / 3, -curve, -h + h / 3, 0, -h);
        ctx.stroke();
        ctx.translate(0, -h);
        ctx.scale(2, 2);
        drawDaisyHead(ctx);
    }

    function drawDaisyHead(ctx) {
        // ctx.strokeStyle = "#24750c";
        ctx.strokeStyle = "#183601";
        ctx.lineWidth = 0.2;
        const blattGrd1 = ctx.createRadialGradient(0, 0, 5, 0, 0, 8);
        blattGrd1.addColorStop(0, "#ffffff");
        blattGrd1.addColorStop(1, "#a844b8");

        const blattGrd2 = ctx.createRadialGradient(0, 0, 6, 0, 0, 8);
        blattGrd2.addColorStop(0, "#ececec");
        blattGrd2.addColorStop(1, "#a844b8");

        ctx.fillStyle = blattGrd1;
        ctx.fill(daisyP1);
        ctx.stroke(daisyP1);
        ctx.fill(daisyP2);
        ctx.stroke(daisyP2);
        ctx.fillStyle = blattGrd2;
        ctx.fill(daisyP3);
        ctx.stroke(daisyP3);
        ctx.fill(daisyP4);
        ctx.stroke(daisyP4);

        ctx.fillStyle = "#ffc803";
        ctx.beginPath();
        ctx.ellipse(0, 0, 2.65, 1.32, 0, 0, 2 * Math.PI);
        ctx.fill();

        ctx.fillStyle = blattGrd1;
        ctx.fill(daisyP6);
        ctx.stroke(daisyP6);
        ctx.fill(daisyP7);
        ctx.stroke(daisyP7);
        ctx.fillStyle = blattGrd2;
        ctx.fill(daisyP8);
        ctx.stroke(daisyP8);
        ctx.fill(daisyP9);
        ctx.stroke(daisyP9);
        ctx.fillStyle = blattGrd1;
        ctx.fill(daisyP10);
        ctx.stroke(daisyP10);
        ctx.fill(daisyP11);
        ctx.stroke(daisyP11);
    }

    // Dandelion ////////////////////////////////////////////////

    function drawDandelions(ctx, gl) {
        const height = gl.grassHeight;
        const widht = gl.grassWidth;
        const das = gl.grassBlades;
        for (let i = 0; i < das.length; i++) {
            const scaleX = das.currentWind[i] < 0 ? -1 : 1;
            const state = currentWindToState(das.currentWind[i]);
            ctx.save();
            ctx.translate(das.posX[i], 150);
            ctx.rotate(das.rotate[i]);
            ctx.scale(scaleX * das.scale[i], das.scale[i]);
            drawDandelion(ctx, state, height, widht, gl.color);
            ctx.restore();
        }
    }
    function drawDandelion(ctx, state, height, width, color) {
        const h = height;
        const angle = state * MAX_BEND_ANGLE_DANDELION_RADS;
        const curve = (angle * 20) / 1.5708;
        ctx.rotate(angle);
        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(-curve, -h / 3, -curve, -h + h / 3, 0, -h);
        ctx.stroke();
        ctx.translate(0, -h + 10);
        ctx.scale(0.5, 0.5);
        drawDandelionHead(ctx);
    }

    function drawDandelionHead(ctx) {
        // ctx.strokeStyle = "#24750c";
        ctx.strokeStyle = "#ffffff88";
        ctx.lineWidth = 0.8;

        ctx.fillStyle = "#f6e200";
        ctx.fill(dandelionP1);
        ctx.stroke(dandelionP1);

        ctx.strokeStyle = "#dccc00";
        ctx.stroke(dandelionP2);

        ctx.strokeStyle = "#ffef0d";
        ctx.stroke(dandelionP3);

        ctx.strokeStyle = "#e8d600";
        ctx.stroke(dandelionP4);

        ctx.strokeStyle = "#ffee17";
        ctx.stroke(dandelionP5);

        ctx.strokeStyle = "#e3d400";
        ctx.stroke(dandelionP6);
    }

    const canvasElement = document.getElementById("fieldCanvas");
    init(canvasElement);
    startAnimation();
</script>